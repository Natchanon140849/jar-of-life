<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Jar of Life: Interactive Lesson (Final)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00796b;
            --bg-grad-1: #e0f2f1;
            --bg-grad-2: #80cbc4;
            --jar-glass: rgba(255, 255, 255, 0.25);
            --rock: #4e342e;
            --pebble: #78909c;
            --sand: #fdd835;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- TOP HEADER (กระดานความรู้) --- */
        .header-panel {
            width: 100%; max-width: 800px;
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px; text-align: center; z-index: 100;
        }
        
        .header-title { color: var(--primary); margin: 0 0 15px 0; font-size: 1.6rem; font-weight: bold; }
        
        .info-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; text-align: left;
        }
        
        .info-card {
            padding: 10px; border-radius: 10px; background: #f5f5f5;
            border-left: 4px solid #ccc; font-size: 0.9rem;
        }
        .info-card h4 { margin: 0 0 5px 0; font-size: 0.95rem; color: #333; }
        .info-card p { margin: 0; font-size: 0.8rem; color: #666; }
        
        .ic-rock { border-color: var(--rock); }
        .ic-pebble { border-color: var(--pebble); }
        .ic-sand { border-color: var(--sand); }
        .ic-jar { border-color: #29b6f6; }

        /* --- GAME AREA --- */
        .game-wrapper {
            position: relative; display: flex; flex-direction: column; align-items: center;
            flex-grow: 1; justify-content: center; width: 100%;
        }

        .jar-container {
            position: relative;
            width: 280px; height: 380px;
            margin-top: 10px;
        }

        .jar {
            width: 100%; height: 100%;
            border: 8px solid white; border-top: none;
            border-radius: 0 0 40px 40px;
            background: var(--jar-glass);
            position: relative;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15), inset 0 0 30px rgba(255,255,255,0.4);
            backdrop-filter: blur(3px);
            z-index: 10;
            overflow: visible; /* อนุญาตให้ของล้น */
        }
        .jar::before { /* ปากขวด */
            content: ''; position: absolute; top: -15px; left: 10px; right: 10px; height: 15px;
            border: 8px solid white; border-bottom: none; border-radius: 10px 10px 0 0;
            background: rgba(255,255,255,0.3);
        }

        /* Layers */
        .sand-fill {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 0%;
            background: var(--sand); border-radius: 0 0 32px 32px;
            transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1; opacity: 0.95;
            background-image: radial-gradient(rgba(255,255,255,0.4) 1px, transparent 1px);
            background-size: 3px 3px;
        }

        .solids-area {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            padding: 10px; box-sizing: border-box;
            display: flex; flex-wrap: wrap-reverse; 
            justify-content: center; align-content: flex-start;
            pointer-events: none; z-index: 5;
        }

        /* โซนของล้น (Overflow Zone) */
        .overflow-area {
            position: absolute; bottom: -50px; left: -150px;
            width: 580px; height: 500px;
            pointer-events: none; z-index: 20;
        }

        /* --- ITEMS GRAPHICS --- */
        .item-rock {
            width: 80px; height: 65px;
            background: radial-gradient(circle at 30% 30%, #8d6e63, #3e2723);
            border-radius: 40% 60% 50% 40%; margin: -4px;
            box-shadow: inset -3px -3px 10px rgba(0,0,0,0.4), 2px 2px 5px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
            color: rgba(255,255,255,0.9); font-size: 0.7rem; font-weight: bold;
            animation: rockDrop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .item-rock::after { content: 'สำคัญ'; opacity: 0.6; }

        .item-pebble {
            width: 16px; height: 16px;
            background: var(--pebble); border-radius: 50%; margin: 1px;
            box-shadow: inset -1px -1px 3px rgba(0,0,0,0.3);
            animation: pebbleDrop 0.4s ease-out;
        }

        /* Animations */
        @keyframes rockDrop { 0% { transform: translateY(-400px) rotate(45deg); opacity: 0; } 100% { transform: translateY(0) rotate(0deg); opacity: 1; } }
        @keyframes pebbleDrop { 0% { transform: translateY(-300px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        
        /* Overflow Animations (ตกออกข้างนอก) */
        @keyframes fallOutLeft {
            0% { transform: translate(120px, -450px); opacity: 1; }
            40% { transform: translate(0px, -50px); } /* ชนปากขวด */
            100% { transform: translate(-80px, 400px) rotate(-90deg); opacity: 1; } /* ตกพื้น */
        }
        @keyframes fallOutRight {
            0% { transform: translate(160px, -450px); opacity: 1; }
            40% { transform: translate(280px, -50px); }
            100% { transform: translate(360px, 400px) rotate(90deg); opacity: 1; }
        }
        
        /* Class สำหรับของล้น */
        .of-rock-l { animation: fallOutLeft 1.2s forwards; position: absolute; bottom: 0; left: 0; }
        .of-rock-r { animation: fallOutRight 1.2s forwards; position: absolute; bottom: 0; left: 0; }
        
        /* กรวดล้น (ตกเร็วกว่านิดหน่อย และกระจายตัว) */
        .of-pebble-l { animation: fallOutLeft 1.0s forwards; position: absolute; bottom: 0; left: 0; width: 14px; height: 14px; background: var(--pebble); border-radius: 50%;}
        .of-pebble-r { animation: fallOutRight 1.0s forwards; position: absolute; bottom: 0; left: 0; width: 14px; height: 14px; background: var(--pebble); border-radius: 50%;}


        /* --- CONTROLS --- */
        .controls {
            margin-top: 25px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
        }
        .btn {
            border: none; padding: 12px 20px; border-radius: 50px;
            background: white; cursor: pointer; min-width: 110px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.1s; display: flex; align-items: center; gap: 8px; justify-content: center;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .btn:active { transform: scale(0.95); }
        .btn span { font-weight: bold; color: #444; font-size: 0.9rem; }

        .btn-rock { border-bottom: 4px solid var(--rock); }
        .btn-pebble { border-bottom: 4px solid var(--pebble); }
        .btn-sand { border-bottom: 4px solid var(--sand); }
        .btn-reset { background: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2; width: 100%; max-width: 200px;}

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); z-index: 200;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        
        .modal-box {
            background: white; padding: 30px; border-radius: 20px; width: 420px;
            text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.8); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.active .modal-box { transform: scale(1); }
        
        .m-icon { font-size: 4rem; margin-bottom: 15px; display: block; }
        .m-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; }
        .m-desc { text-align: left; color: #555; background: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px; line-height: 1.6;}
        .m-btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1rem; width: 100%;
        }

        /* Status Colors */
        .status-intro .m-icon { color: var(--primary); }
        .status-error .m-icon { color: #d32f2f; }
        .status-success .m-icon { color: #388e3c; }

    </style>
</head>
<body>

    <div class="header-panel">
        <h1 class="header-title">ทฤษฎีกระปุกทราย (Jar of Life)</h1>
        <div class="info-grid">
            <div class="info-card ic-jar">
                <h4><i class="fas fa-flask"></i> ขวดโหล</h4>
                <p>เวลาชีวิตที่มีจำกัด<br>(24 ชม. / วัน)</p>
            </div>
            <div class="info-card ic-rock">
                <h4><i class="fas fa-circle"></i> ก้อนหิน</h4>
                <p>เรื่องสำคัญที่สุด<br>(สุขภาพ/ครอบครัว)</p>
            </div>
            <div class="info-card ic-pebble">
                <h4><i class="fas fa-braille"></i> กรวด</h4>
                <p>เรื่องสำคัญรองลงมา<br>(งาน/ทรัพย์สิน)</p>
            </div>
            <div class="info-card ic-sand">
                <h4><i class="fas fa-wind"></i> ทราย</h4>
                <p>เรื่องเล็กน้อย<br>(ความบันเทิง)</p>
            </div>
        </div>
    </div>

    <div class="game-wrapper">
        <div class="jar-container">
            <div class="jar">
                <div class="sand-fill" id="sandLayer"></div>
                <div class="solids-area" id="solidsLayer"></div>
            </div>
            <div class="overflow-area" id="overflowLayer"></div>
        </div>

        <div class="controls">
            <button class="btn btn-rock" onclick="addRock()">
                <i class="fas fa-circle" style="color:var(--rock)"></i> <span>เติมหิน</span>
            </button>
            <button class="btn btn-pebble" onclick="addPebble()">
                <i class="fas fa-braille" style="color:var(--pebble)"></i> <span>เติมกรวด</span>
            </button>
            <button class="btn btn-sand" onclick="addSand()">
                <i class="fas fa-wind" style="color:#fbc02d"></i> <span>เติมทราย</span>
            </button>
            <div style="width: 100%; display: flex; justify-content: center;">
                <button class="btn btn-reset" onclick="resetGame()">
                    <i class="fas fa-redo"></i> <span>เริ่มใหม่</span>
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-box status-intro" id="modalBox">
            <i class="fas fa-lightbulb m-icon" id="mIcon"></i>
            <div class="m-title" id="mTitle">ยินดีต้อนรับ</div>
            <div class="m-desc" id="mDesc">รายละเอียด...</div>
            <button class="m-btn" onclick="closeModal()">ตกลง</button>
        </div>
    </div>

    <script>
        // --- State ---
        let hasRock = false;
        let hasPebble = false;
        let hasSand = false;
        let jarFull = false;

        // --- Elements ---
        const solidsLayer = document.getElementById('solidsLayer');
        const overflowLayer = document.getElementById('overflowLayer');
        const sandLayer = document.getElementById('sandLayer');
        const modal = document.getElementById('modal');
        const modalBox = document.getElementById('modalBox');
        const mTitle = document.getElementById('mTitle');
        const mDesc = document.getElementById('mDesc');
        const mIcon = document.getElementById('mIcon');

        // 1. Start Intro
        window.onload = function() {
            showModal('intro', 'สวัสดีครับ!', 
            'นี่คือแบบจำลอง <b>"การบริหารเวลา"</b><br><br>ลองดูข้อมูลด้านบน แล้วทดลองเติมสิ่งของลงในขวดดูนะครับ ว่าต้องเรียงลำดับอย่างไรจึงจะใส่ได้ครบทุกอย่าง?');
        };

        // --- Game Logic ---

        function addRock() {
            // ถ้าขวดเต็ม หรือใส่หินไปแล้ว -> ล้น
            if ((jarFull || hasSand) && !hasRock) { triggerOverflow('rock'); return; }

            if (!hasRock) {
                // ใส่หิน 4 ก้อนใหญ่ (Visual)
                for(let i=0; i<4; i++) setTimeout(() => createVisualRock(solidsLayer), i * 150);
                hasRock = true;
                checkWin();
            }
        }

        function addPebble() {
            // ถ้าขวดเต็ม (มีทรายแล้ว) -> กรวดล้น
            if ((jarFull || hasSand) && !hasPebble) { triggerOverflow('pebble'); return; }

            if (!hasPebble) {
                // ใส่กรวด 48 เม็ด (Visual)
                for(let i=0; i<48; i++) setTimeout(() => createVisualPebble(solidsLayer), i * 15);
                hasPebble = true;
                checkWin();
            }
        }

        function addSand() {
            if (hasSand) return;

            // ทรายไหลแทรกซึม
            hasSand = true;
            sandLayer.style.height = '100%';
            jarFull = true;
            setTimeout(checkWin, 1200);
        }

        // --- OVERFLOW ANIMATION (ของล้น) ---
        function triggerOverflow(type) {
            if (type === 'rock') {
                // หินล้น 4 ก้อน
                for(let i=0; i<4; i++) {
                    setTimeout(() => {
                        const div = document.createElement('div');
                        div.className = 'item-rock';
                        div.classList.add(Math.random() > 0.5 ? 'of-rock-l' : 'of-rock-r');
                        overflowLayer.appendChild(div);
                    }, i*200);
                }
                setTimeout(() => showModal('error', 'หินล้นออกมา!', 'คุณใส่ "ทราย" จนเต็มขวดแล้ว ทำให้ไม่มีที่ว่างเหลือสำหรับ "หินก้อนใหญ่" ครับ'), 1000);
            } 
            else if (type === 'pebble') {
                // กรวดล้น (เทกระจาด 30 เม็ด)
                for(let i=0; i<30; i++) {
                    setTimeout(() => {
                        const div = document.createElement('div');
                        div.className = 'of-pebble-' + (Math.random() > 0.5 ? 'l' : 'r'); // สุ่มซ้ายขวา
                        // สุ่ม delay นิดหน่อยให้ดูเป็นสายน้ำ
                        div.style.animationDelay = (Math.random() * 0.5) + 's';
                        overflowLayer.appendChild(div);
                    }, i*20);
                }
                setTimeout(() => showModal('error', 'กรวดล้นออกมา!', 'ทรายเม็ดละเอียดได้เข้าไปแทนที่ช่องว่างหมดแล้ว กรวดแทรกตัวลงไปไม่ได้ครับ'), 1000);
            }
        }

        // --- CHECK WIN ---
        function checkWin() {
            if (hasRock && hasPebble && hasSand) {
                setTimeout(() => {
                    showModal('success', 'Perfect Balance!', 
                    '<b>ยอดเยี่ยม! คุณบริหารเวลาได้ถูกต้อง</b><br><br>1. <b>หิน:</b> เรื่องสำคัญที่สุด (มาก่อน)<br>2. <b>กรวด:</b> เรื่องสำคัญรอง (แทรกตามช่องว่าง)<br>3. <b>ทราย:</b> เรื่องเล็กน้อย (เติมเต็มส่วนที่เหลือ)');
                }, 1000);
            }
        }

        // --- VISUAL GENERATORS ---
        function createVisualRock(container) {
            const div = document.createElement('div');
            div.className = 'item-rock';
            const r = () => Math.floor(Math.random() * 20 + 40) + '%';
            div.style.borderRadius = `${r()} ${r()} ${r()} ${r()}`;
            container.appendChild(div);
        }

        function createVisualPebble(container) {
            const div = document.createElement('div');
            div.className = 'item-pebble';
            div.style.marginLeft = (Math.random() * 60 - 30) + 'px';
            container.appendChild(div);
        }

        // --- MODAL & RESET ---
        function showModal(status, title, desc) {
            modalBox.className = 'modal-box status-' + status;
            mTitle.innerHTML = title;
            mDesc.innerHTML = desc;
            
            if(status === 'intro') mIcon.className = 'fas fa-book-open m-icon';
            if(status === 'error') mIcon.className = 'fas fa-exclamation-circle m-icon';
            if(status === 'success') mIcon.className = 'fas fa-star m-icon';
            
            modal.classList.add('active');
        }

        function closeModal() { modal.classList.remove('active'); }

        function resetGame() {
            hasRock = false; hasPebble = false; hasSand = false; jarFull = false;
            solidsLayer.innerHTML = ''; overflowLayer.innerHTML = ''; sandLayer.style.height = '0%';
            closeModal();
        }

    </script>
</body>
</html>